name: Run Price Hunter

# 이 명령서를 언제 실행할지 정합니다.
on:
  # 1. 1시간마다 자동으로 실행 (cron 스케줄)
  schedule:
    - cron: '0 * * * *' # 매시 정각에 실행

  # 2. GitHub에서 'Actions' 탭을 눌러 수동으로 실행할 수도 있게 함
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest # 리눅스 '봇' 컴퓨터에서 실행

    steps:
      # 1. 내 저장소의 코드를 '봇' 컴퓨터로 가져오기 (Checkout)
      - name: Checkout repository
        uses: actions/checkout@v4

      # 2. Python 3.11 버전 설치하기
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      # 3. 필요한 라이브러리 설치하기 (requirements.txt 이용)
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      # 4. (중요) Selenium이 Linux 봇에서 작동하도록 Chrome 설치하기
      - name: Install Google Chrome
        run: |
          sudo apt-get update
          sudo apt-get install -y google-chrome-stable

      # 5. 핵심 스크립트 실행하기
      - name: Run Price Hunter Script
        run: python deal_hunter_v2.0.py

      # 6. (가장 중요) 변경된 'last_prices.json' 파일을 저장소에 다시 커밋하기
      - name: Commit and push if files changed
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          git add last_prices.json config.json

          # 파일이 변경되었을 때만 커밋
          if git diff --staged --quiet; then
            echo "No changes to commit."
          else
            git commit -m "Update last_prices.json"
            git push
          fi
